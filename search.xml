<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RocketMQ可视化界面安装</title>
      <link href="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/"/>
      <url>/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="RocketMQ可视化界面安装"><a href="#RocketMQ可视化界面安装" class="headerlink" title="RocketMQ可视化界面安装"></a>RocketMQ可视化界面安装</h1><p>**起因：**访问rocketmq-externals项目的git地址，下载了源码，在目录中并没有找到rocketmq-console文件夹。</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/c05b0433185fafe34db4cdcb40dc2e19.png" class="" title="MQ仪表板"><p>git下面文档提示rocketMQ的仪表板转移到了新的项目中，点击<a href="https://github.com/apache/rocketmq-externals?tab=readme-ov-file">仪表板</a>到新项目地址；</p><ol><li><p>下载源码</p></li><li><p>进入到项目的resources资源目录下</p><blockquote><p>rocketmq-dashboard\src\main\resources</p></blockquote></li><li><p>编辑application.yml配置文件，配置控制台的端口号和nameServer地址。</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/9a00bc614ed787fe1cbf8fe8a92e23c2.png" class="" title="配置文件"></li><li><p>在项目根目录下打开git命令窗,执行<code>mvn clean package -Dmaven.test.skip=true</code></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="meta">@DESKTOP</span>-G6MAR8U MINGW64 /d/Program/rocketmq-dashboard (master)</span><br><span class="line">$ mvn clean <span class="keyword">package</span> -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><p>**注意：**在这里可能会打包失败，</p><p>具体异常：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal com.github.eirslett:frontend-maven-plugin:<span class="number">1.11</span><span class="number">.3</span>:yarn (yarn install) on project rocketmq-dashboard: Failed to run task: <span class="string">'yarn install'</span> failed. org.apache.commons.exec.ExecuteException: Process exited with an error: <span class="number">1</span> (Exit value: <span class="number">1</span>) -&gt; [Help <span class="number">1</span>]</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] To see the full stack trace of the errors, re-run Maven with the -e <span class="keyword">switch</span>.</span><br><span class="line">[ERROR] Re-run Maven using the -X <span class="keyword">switch</span> to enable full debug logging.</span><br><span class="line">[ERROR]</span><br><span class="line">[ERROR] For more information about the errors and possible solutions, please read the following articles:</span><br><span class="line">[ERROR] [Help <span class="number">1</span>] http:<span class="comment">//cwiki.apache.org/confluence/display/MAVEN/MojoFailureException</span></span><br></pre></td></tr></tbody></table></figure><p>解决方法：</p><p>打开项目中的pom.xml文件，注释以下两个插件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">                &lt;version&gt;2.17&lt;/version&gt;</span></span><br><span class="line"><span class="comment">                &lt;executions&gt;</span></span><br><span class="line"><span class="comment">                    &lt;execution&gt;</span></span><br><span class="line"><span class="comment">                        &lt;id&gt;validate&lt;/id&gt;</span></span><br><span class="line"><span class="comment">                        &lt;phase&gt;validate&lt;/phase&gt;</span></span><br><span class="line"><span class="comment">                        &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                            &lt;excludes&gt;src/main/resources&lt;/excludes&gt;</span></span><br><span class="line"><span class="comment">                            &lt;configLocation&gt;style/rmq_checkstyle.xml&lt;/configLocation&gt;</span></span><br><span class="line"><span class="comment">                            &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span></span><br><span class="line"><span class="comment">                            &lt;consoleOutput&gt;true&lt;/consoleOutput&gt;</span></span><br><span class="line"><span class="comment">                            &lt;failsOnError&gt;true&lt;/failsOnError&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">                        &lt;goals&gt;</span></span><br><span class="line"><span class="comment">                            &lt;goal&gt;check&lt;/goal&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/goals&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/execution&gt;</span></span><br><span class="line"><span class="comment">                &lt;/executions&gt;</span></span><br><span class="line"><span class="comment">            &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">                &lt;groupId&gt;com.github.eirslett&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">                &lt;artifactId&gt;frontend-maven-plugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">                &lt;version&gt;1.11.3&lt;/version&gt;</span></span><br><span class="line"><span class="comment">                &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                    &lt;workingDirectory&gt;frontend&lt;/workingDirectory&gt;</span></span><br><span class="line"><span class="comment">                    &lt;installDirectory&gt;target&lt;/installDirectory&gt;</span></span><br><span class="line"><span class="comment">                &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">                &lt;executions&gt;</span></span><br><span class="line"><span class="comment">                    &lt;execution&gt;</span></span><br><span class="line"><span class="comment">                        &lt;id&gt;install node and yarn&lt;/id&gt;</span></span><br><span class="line"><span class="comment">                        &lt;goals&gt;</span></span><br><span class="line"><span class="comment">                            &lt;goal&gt;install-node-and-yarn&lt;/goal&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/goals&gt;</span></span><br><span class="line"><span class="comment">                        &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                            &lt;nodeVersion&gt;v16.2.0&lt;/nodeVersion&gt;</span></span><br><span class="line"><span class="comment">                            &lt;yarnVersion&gt;v1.22.10&lt;/yarnVersion&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/execution&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                    &lt;execution&gt;</span></span><br><span class="line"><span class="comment">                        &lt;id&gt;yarn install&lt;/id&gt;</span></span><br><span class="line"><span class="comment">                        &lt;goals&gt;</span></span><br><span class="line"><span class="comment">                            &lt;goal&gt;yarn&lt;/goal&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/goals&gt;</span></span><br><span class="line"><span class="comment">                        &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                            &lt;arguments&gt;install&lt;/arguments&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/execution&gt;</span></span><br><span class="line"><span class="comment">                    &lt;execution&gt;</span></span><br><span class="line"><span class="comment">                        &lt;id&gt;yarn build&lt;/id&gt;</span></span><br><span class="line"><span class="comment">                        &lt;goals&gt;</span></span><br><span class="line"><span class="comment">                            &lt;goal&gt;yarn&lt;/goal&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/goals&gt;</span></span><br><span class="line"><span class="comment">                        &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">                            &lt;arguments&gt;build&lt;/arguments&gt;</span></span><br><span class="line"><span class="comment">                        &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">                    &lt;/execution&gt;</span></span><br><span class="line"><span class="comment">                &lt;/executions&gt;</span></span><br><span class="line"><span class="comment">            &lt;/plugin&gt; </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>还有另一异常：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-antrun-plugin:<span class="number">1.8</span>:run (<span class="keyword">default</span>) on project rocketmq-dashboard: An Ant BuildException has occured: D:\ProgramFiles\RocketMQ\rocketmq-dashboard\frontend\build does not exist.</span><br><span class="line">[ERROR] around Ant part ...&lt;copy todir=<span class="string">"D:\ProgramFiles\RocketMQ\rocketmq-dashboard\target/classes/public"</span>&gt;... @ <span class="number">4</span>:<span class="number">83</span> in D:\ProgramFiles\RocketMQ\rocketmq-dashboard\target\antrun\build-main.xml</span><br></pre></td></tr></tbody></table></figure><p>解决：在 rocketmq-dashboard\frontend 建一个build文件夹，然后再target目录下，建一个classes文件夹,classes下再建一个public文件夹</p></li><li><p>执行mvn命令</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install -Dmaven.test.skip=<span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>执行成功后，target目录下会有一个jar包，然后执行java命令运行就可以了。</p></li><li><p>访问：127.0.0.1:9998  (jar运行的服务器地址 : xml中配置的端口号）</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/bf119b4fad7460459535238ed6ddc43d.png" class="" title="可视化界面"><p>相关文章链接：<br> <a href="https://blog.csdn.net/qq_45515766/article/details/126360526">https://blog.csdn.net/qq_45515766/article/details/126360526</a><br> <a href="https://blog.csdn.net/xiaoyiny/article/details/132134052">https://blog.csdn.net/xiaoyiny/article/details/132134052</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rocketmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mvn命令报没有配置jdk环境</title>
      <link href="/2024/06/06/mvn%E5%91%BD%E4%BB%A4%E6%8A%A5%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AEjdk%E7%8E%AF%E5%A2%83/"/>
      <url>/2024/06/06/mvn%E5%91%BD%E4%BB%A4%E6%8A%A5%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AEjdk%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="mvn-命令报没有配置jdk环境"><a href="#mvn-命令报没有配置jdk环境" class="headerlink" title="mvn 命令报没有配置jdk环境"></a>mvn 命令报没有配置jdk环境</h1><p>jdk环境变量配置没问题，并且java -version 也正常显示。</p><p>执行mvn -v 报错误：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/d/Program Files/maven/apache-maven-3.9.5/bin/mvn: line 93: cd: C:\Program Files\Java\jdk-19;: No such file or directory</span><br><span class="line">The JAVA_HOME environment variable is not defined correctly,</span><br><span class="line">this environment variable is needed to run this program.</span><br></pre></td></tr></tbody></table></figure><p><strong>解决方法：</strong></p><ol><li>命令行设置<em>JAVA_HOME</em></li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自己本机jdk安装目录（C:\Program Files\Java\jdk-19）</span></span><br><span class="line">setx JAVA_HOME <span class="string">"C:\Program Files\Java\jdk-19"</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>更新<em>Path</em>变量</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//maven的安装目录（D:\Program Files\maven\apache-maven-3.9.5）</span></span><br><span class="line">setx PATH <span class="string">"%JAVA_HOME%\bin;D:\Program Files\maven\apache-maven-3.9.5\bin;%PATH%"</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><em>关闭并重新打开命令提示符</em>，然后运行以下命令验证配置：</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line">mvn -version</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Bean 生命周期</title>
      <link href="/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Bean-生命周期"><a href="#Spring-Bean-生命周期" class="headerlink" title="Spring Bean 生命周期"></a>Spring Bean 生命周期</h2><h3 id="bean的4个阶段"><a href="#bean的4个阶段" class="headerlink" title="bean的4个阶段"></a>bean的4个阶段</h3><ol><li>Bean的<strong>实例化</strong>阶段</li><li>Bean的<strong>设置属性</strong>阶段</li><li>Bean的<strong>初始化</strong>阶段</li><li>Bean的<strong>销毁</strong>阶段</li></ol><img src="/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/shengmingzhouqi.jpeg" class="" title="生命周期-流程图"><h4 id="实例化Bean"><a href="#实例化Bean" class="headerlink" title="实例化Bean"></a>实例化Bean</h4><ol><li><p>Bean Definition Loading（bean定义加载）</p><p>Spring容器从配置文件或者注解中读取Bean定义信息，这些定义信息包括Bean的类名、作用范围（scope）、依赖关系（循环依赖问题）、初始化方法。</p></li><li><p>Bean Instantiation（Bean实例化）</p><p>Spring<strong>通过反射机制创建Bean实例</strong>，spring调用Bean的构造函数来实例化对象。</p></li></ol><h4 id="设置属性"><a href="#设置属性" class="headerlink" title="设置属性"></a>设置属性</h4><ol><li><p>Spring容器在实例化Bean之后，会进行依赖注入，将Bean所依赖的其他Bean注入到该Bean中，此过程使用setter方法或者反射直接访问字段;</p><ul><li><p>bean依赖注入3种方式</p></li><li><p>@Autowired, @Resource, @Qualifier, @Bean 几个自动注入注解区别</p></li></ul></li></ol><h4 id="实现Aware类接口"><a href="#实现Aware类接口" class="headerlink" title="实现Aware类接口"></a>实现Aware类接口</h4><p>在<code>postProcessBeforeInitialization</code>方法执行前，会执行很多Aware类型的接口，这种接口的作用是：<strong>允许bean获取到Spring容器的特定资源或信息</strong>。由Spring容器自动调用相应的方法，<strong>将相关资源或信息注入到bean中</strong>。</p><p>常见Aware接口：</p><ol><li><code>BeanNameAware</code>：<ul><li>方法：<code>setBeanName(String name)</code></li><li>作用：将当前bean的名称注入到bean中。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>BeanFactoryAware</code>：<ul><li>方法：<code>setBeanFactory(BeanFactory beanFactory)</code></li><li>作用：将<code>BeanFactory</code>注入到bean中。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>ApplicationContextAware</code>：<ul><li>方法：<code>setApplicationContext(ApplicationContext applicationContext)</code></li><li>作用：将<code>ApplicationContext</code>注入到bean中。</li><li>执行时机：在<code>BeanFactoryAware</code>之后调用。</li></ul></li><li><code>ResourceLoaderAware</code>：<ul><li>方法：<code>setResourceLoader(ResourceLoader resourceLoader)</code></li><li>作用：将<code>ResourceLoader</code>注入到bean中，允许bean加载资源文件。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>EnvironmentAware</code>：<ul><li>方法：<code>setEnvironment(Environment environment)</code></li><li>作用：将<code>Environment</code>注入到bean中，允许bean访问环境信息。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li></ol><h4 id="BeanPostProcessor-初始化前后置处理"><a href="#BeanPostProcessor-初始化前后置处理" class="headerlink" title="BeanPostProcessor(初始化前后置处理)"></a>BeanPostProcessor(初始化前后置处理)</h4><ol><li><p>解释：</p><p>对新创建的bean实例进行自定义修改，通过实现该接口，可以<strong>在初始化bean前后进行额外的处理</strong>。</p></li><li><p>实现方法</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException;</span><br></pre></td></tr></tbody></table></figure><ul><li><code>postProcessBeforeInitialization</code>: 在bean初始化之前调用，可以对bean进行处理，然后放回处理后的bean实例。</li><li><code>postProcessAfterInitialization</code>: 在bean初始化之后调用，可以对bean进行后续处理，然后返回处理后的bean实例。</li></ul></li><li><p>使用场景</p><ul><li>日志记录：可以在bean初始化前后记录日志，方便调试和监控；</li><li>属性检查或设置：在bean初始化之前检查或设置某些属性；</li><li>代理对象创建：额可以在bean初始化之后创建代理对象，用于AOP场景；</li></ul></li></ol><h4 id="Bean初始化"><a href="#Bean初始化" class="headerlink" title="Bean初始化"></a>Bean初始化</h4><ul><li><p>使用@PostConstruct注解， 执行顺序 &gt; 下面两种方式</p></li><li><p>继承<code>InitializingBean</code>实现afterPropertiesSet()方法</p></li><li><p>在@Bean注解上指定初始化方法（等同于使用spring中xml方法指定init-method属性的方法，但是现在谁还用spring xml啊）</p></li></ul><h4 id="Bean销毁"><a href="#Bean销毁" class="headerlink" title="Bean销毁"></a>Bean销毁</h4><ul><li><code>@PreDestory</code> 注解，用于在Spring Bean被销毁之前执行清理逻辑（释放资源，关闭连接等），可以与 <code>@PostConstruct</code> 注解结合使用，确保在 Bean 初始化和销毁时执行相应的逻辑。</li><li>实现<code>DisposableBean</code>接口destroy()方法</li><li>在@Bean注解上destroyMethod属性指定销毁方法</li></ul><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> <span class="keyword">implements</span> <span class="title class_">BeanNameAware</span>, ApplicationContextAware, InitializingBean {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">()</span> {</span><br><span class="line">        log.info(<span class="string">"1.调用构造方法实例化"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span> {</span><br><span class="line">        <span class="built_in">this</span>.beanName = name;</span><br><span class="line">        log.info(<span class="string">"2.实现BeanNameAware接口：{}"</span>, name);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        log.info(<span class="string">"3.实现ApplicationContextAware接口：{}"</span>, applicationContext);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> {</span><br><span class="line">        log.info(<span class="string">"6.使用继承InitializingBean初始化：{}"</span>, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>{</span><br><span class="line">        log.info(<span class="string">"7.使用init-method初始化：{}"</span>, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init1</span><span class="params">()</span>{</span><br><span class="line">        log.info(<span class="string">"5.使用@PostConstruct初始化：{}"</span>, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyAnno</span><span class="params">()</span>{</span><br><span class="line">        log.info(<span class="string">"9.@PreDestroy销毁bean：{}"</span>, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>{</span><br><span class="line">        log.info(<span class="string">"10.使用destroy-method配置销毁bean：{}"</span>, beanName);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanPostProcessorImpl</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        log.info(<span class="string">"4.实例：{} 初始化前"</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">        log.info(<span class="string">"8.实例：{} 初始化后"</span>, beanName);</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessAfterInitialization(bean, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(initMethod = "init", destroyMethod = "destroy")</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">myBean</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DestroyService</span> <span class="keyword">implements</span> <span class="title class_">DisposableBean</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> {</span><br><span class="line">        log.info(<span class="string">"11.实现DisposableBean接口执行销毁方法"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.548</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">1.</span>调用构造方法实例化</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.550</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">2.</span>实现BeanNameAware接口：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.550</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">3.</span>实现ApplicationContextAware接口：org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@<span class="number">7e276594</span>, started on Fri May <span class="number">24</span> <span class="number">18</span>:<span class="number">18</span>:<span class="number">57</span> CST <span class="number">2024</span></span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.550</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] c.l.springBean.BeanPostProcessorImpl     : <span class="number">4.</span>实例：myBean 初始化前</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.551</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">5.</span>使用<span class="meta">@PostConstruct</span>初始化：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.551</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">6.</span>使用继承InitializingBean初始化：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.552</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] com.leejie.springBean.MyBean             : <span class="number">7.</span>使用init-method初始化：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">18</span>:<span class="number">58.552</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [           main] c.l.springBean.BeanPostProcessorImpl     : <span class="number">8.</span>实例：myBean 初始化后</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">23</span>:<span class="number">15.637</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [ionShutdownHook] com.leejie.springBean.MyBean             : <span class="number">9.</span><span class="meta">@PreDestroy</span>销毁bean：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">23</span>:<span class="number">15.638</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [ionShutdownHook] com.leejie.springBean.MyBean             : <span class="number">10.</span>使用destroy-method配置销毁bean：myBean</span><br><span class="line"><span class="number">2024</span>-<span class="number">05</span>-24T18:<span class="number">23</span>:<span class="number">15.638</span>+08:<span class="number">00</span>  INFO <span class="number">18372</span> --- [springs] [ionShutdownHook] com.leejie.springBean.DestroyService     : <span class="number">11.</span>实现DisposableBean接口执行销毁方法</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot之监听器</title>
      <link href="/2022/06/17/springboot%E4%B9%8B%E7%9B%91%E5%90%AC%E5%99%A8/"/>
      <url>/2022/06/17/springboot%E4%B9%8B%E7%9B%91%E5%90%AC%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="springboot之监听器"><a href="#springboot之监听器" class="headerlink" title="springboot之监听器"></a>springboot之监听器</h1><p>ApplicationContext提供时间处理通过ApplicationEvent类和ApplicationListener接口，如果一个bean实现ApplicationListener接口在容器中，每次一个ApplicationEvent被发布到ApplcationContext中，这类bean就会收到这些通知。</p><p>实现Spring事件机制主要有4个类：</p><p>ApplicationEvent：事件，每个实现类表示一类事件，可携带数据。</p><p>ApplicationListener：事件监听器，用于接收事件处理时间。</p><p>ApplicationEventMulticaster：事件管理者，用于事件监听器的注册和事件的广播。</p><p>ApplicationEventPublisher：事件发布者，委托ApplicationEventMulticaster完成事件发布。</p><h2 id="监听器使用"><a href="#监听器使用" class="headerlink" title="监听器使用"></a>监听器使用</h2><p>Web监听器的使用场景很多，比如监听servlet上下应用来初始化一些数据，监听HTTP Session 用来获取当前在线人数，监听客服端请求的ServletRequest 对象来获取用户的访问信息等等。</p><h3 id="监听-Servlet-上下文对象"><a href="#监听-Servlet-上下文对象" class="headerlink" title="监听 Servlet 上下文对象"></a>监听 Servlet 上下文对象</h3><ol><li><p>首先我们要知道ServletContext的作用和详解</p><p>ServletContext是一个全局的存储信息的空间，服务器开始就存在，服务器关闭就释放。request，一个用户可以有多个；session，一个用户一个；而servletContext是所有用户共用一个。</p><p>运行在java虚拟机中的每一个web程序都有一个与之相关的Servlet上下文。一个ServletContext对象表示了一个web应用程序的上下文。</p><p>Servlet上下文：Servlet上下文提供了对应用程序中所有Servlet所共有的各种资源和功能的访问。Servlet上下文API用于设置应用程序中所有Servlet共有的信息。Servlet可能需要共享他们之间的共有信息。运行于同一服务器的Servlet有时会共享资源，如JSP页面、文件和其他Servlet。</p></li></ol><p>实践：<a href="https://blog.csdn.net/taojin12/article/details/88338199">Spring Boot 中使用监听器</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分布式事务</title>
      <link href="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
      <url>/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h1><h3 id="什么是分布式？"><a href="#什么是分布式？" class="headerlink" title="什么是分布式？"></a>什么是分布式？</h3><p>了解分布式之前先看一下单机和集群的概念</p><p><strong>单机结构</strong></p><p>单机就是所有业务全部写在一个项目中，部署服务到一台服务器上，所有请求业务都由这台服务器去处理，当业务增长到一定程度的时候，服务器的硬件会无法满足业务需求，然后就会想到一个程序不行就部署多个。</p><p><strong>集群</strong></p><ol><li>集群就是单机的多实例，在多个服务器上部署多个服务，每个服务就是一个节点，部署N个节点，处理业务的能力就提升N倍，这些节点的结合就叫做集群。</li><li>负载均衡：协调群里的每个节点均衡的接受业务请求，通俗的讲就是服务A和服务B相同时间段内处理的同类业务请求数量是类似的。</li></ol><p><strong>分布式</strong></p><p>分布式服务顾名思义服务是分散部署在不同的机器上的，一个服务可能负责几个功能，是一种面向SOA架构的，服务之间也是通过rpc来交互或者是webservice来交互的。逻辑架构设计完后就该做物理架构设计，系统应用部署在超过一台服务器或虚拟机上，且各分开部署的部分彼此通过各种通讯协议交互信息，就可算作分布式部署，生产环境下的微服务肯定是分布式部署的，分布式部署的应用不一定是微服务架构的，比如集群部署，它是把相同应用复制到不同服务器上，但是逻辑功能上还是单体应用。<br>举个例子，假如需要开发一个在线商城。按照微服务的思想，我们需要按照功能模块拆分成多个独立的服务，如：用户服务、产品服务、订单服务、后台管理服务、数据分析服务等。</p><h3 id="分布式事务-1"><a href="#分布式事务-1" class="headerlink" title="分布式事务"></a>分布式事务</h3><p>分布式事务用于在分布式系统中保证不同节点之间的数据一致性。分布式事务的实现有很多中，最具有代表性的是oracle系统提出的XA分布式事务协议。</p><p>XA协议包含两阶段提交（2PC）和三阶段提交（3PC）两种实现：</p><p>在XA协议中包含着两个角色：事务协调者和事务参与者。</p><p><strong>第一阶段</strong></p><img src="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/001dcf51c7a64b9249e0fe6fc1b546ce.png" class="" title="第一阶段"><p>在XA分布式事务的第一阶段，作为事务协调者的阶段会首先向所有的参与者节点发送Prepare请求。</p><p>在接到Prepare请求之后，每个参与者节点会各自事务相关的数据更新，写入Undo Log 和 Redo Log。如果参与者执行成功，暂时不提交事务，而是向事务协调节点返回“完成”消息。</p><p>当事务协调者接收到所有参与者返回消息，整个分布式事务将会进入第二阶段。</p><p><strong>第二阶段</strong></p><img src="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/98e89361be7f3457d3d1a1aea975d523.png" class="" title="第二阶段"><p>在XA分布式事务的第二阶段，如果事务协调节点在之前所收到都是正向返回，那么他将会向所有事务参与者发出commit提交。</p><p>接到commit请求之后，十五参与者节点会各自进行本地的事务提交，并释放资源。当本地事务完成提交之后，将会向事务协调者返回“完成”消息。</p><p>当事务协调者接收到所有事务参与者的“完成”反馈，整个分布式事务完成。</p><p><strong>失败处理流程</strong></p><p>在XA的第一阶段，如果某个事务参与者反馈失败消息，说明该节点的本地事务执行不成功，必须回滚。</p><p>于是在第二阶段，事务协调节点向所有的事务参与者发送Abort请求。接收到Abort请求之后，各个事务参与者节点需要在本地进行事务的回滚操作，回滚操作依照Undo Log来进行。</p><p><strong>两段提交不足之处</strong></p><ol><li><p>性能问题</p><p>XA协议遵循强一致性。在事务执行过程中，各个节点占用着数据库资源，只有当所有阶段准备完毕，事务协调者才会通知提交，参与者提交之后释放资源。这样的过程有着非常明显的性能问题。</p></li><li><p>协调者单点故障问题</p><p>事务协调这是整个XA模型的核心，一旦事务协调者节点挂掉，参与者收不到提交或是回国通知，参与者会一直处于中间状态无法完成事务。</p></li><li><p>丢失消息导致不一致问题</p><p>在第二阶段，如果发生局部网络问题，一部分事务参与者收到提交消息，另一部分事务参与者没收到提交消息，那么就导致了节点之间数据的不一致。</p></li></ol><p><strong>解决方案：</strong></p><ol><li><p>XA三段提交</p><p>XA三阶段提交在两阶段提交的基础上增加了CanCommit阶段，并且引入了超时机制。一旦事物参与者迟迟没有接到协调者的commit请求，会自动进行本地commit。这样有效解决了协调者单点故障的问题。但是性能问题和不一致的问题仍然没有根本解决。</p></li><li><p>MQ事务</p><p>利用消息中间件来异步完成事务的后一半更新，实现系统的最终一致性。这个方式避免了像XA协议那样的性能问题。</p></li><li><p>TCC事务</p><p>TCC事务是Try、Commit、Cancel三种指令的缩写，其逻辑模式类似于XA两阶段提交，但是实现方式是在代码层面来人为实现。</p></li></ol><p>推荐文章：<a href="https://blog.csdn.net/bjweimengshu/article/details/79607522">漫画：什么是分布式事务？</a>   <a href="https://zhuanlan.zhihu.com/p/183753774">分布式事务六种解决方案</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 分布式事务 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
