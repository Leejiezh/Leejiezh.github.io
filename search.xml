<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ceshi02</title>
      <link href="/2025/11/24/ceshi02/"/>
      <url>/2025/11/24/ceshi02/</url>
      
        <content type="html"><![CDATA[<h1 id="「深度来自积累，能力来自坚持。」"><a href="#「深度来自积累，能力来自坚持。」" class="headerlink" title="「深度来自积累，能力来自坚持。」"></a>「深度来自积累，能力来自坚持。」</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQ可视化界面安装</title>
      <link href="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/"/>
      <url>/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="RocketMQ可视化界面安装"><a href="#RocketMQ可视化界面安装" class="headerlink" title="RocketMQ可视化界面安装"></a>RocketMQ可视化界面安装</h1><p>**起因：**访问rocketmq-externals项目的git地址，下载了源码，在目录中并没有找到rocketmq-console文件夹。</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/c05b0433185fafe34db4cdcb40dc2e19.png" class="" title="MQ仪表板"><p>git下面文档提示rocketMQ的仪表板转移到了新的项目中，点击<a href="https://github.com/apache/rocketmq-externals?tab=readme-ov-file">仪表板</a>到新项目地址；</p><ol><li><p>下载源码</p></li><li><p>进入到项目的resources资源目录下</p><blockquote><p>rocketmq-dashboard\src\main\resources</p></blockquote></li><li><p>编辑application.yml配置文件，配置控制台的端口号和nameServer地址。</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/9a00bc614ed787fe1cbf8fe8a92e23c2.png" class="" title="配置文件"></li><li><p>在项目根目录下打开git命令窗,执行<code>mvn clean package -Dmaven.test.skip=true</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">admin<span class="token annotation punctuation">@DESKTOP</span><span class="token operator">-</span><span class="token constant">G6MAR8U</span> <span class="token constant">MINGW64</span> <span class="token operator">/</span>d<span class="token operator">/</span><span class="token class-name">Program</span><span class="token operator">/</span>rocketmq<span class="token operator">-</span>dashboard <span class="token punctuation">(</span>master<span class="token punctuation">)</span>$ mvn clean <span class="token keyword">package</span> <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>**注意：**在这里可能会打包失败，</p><p>具体异常：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">execute</span> goal com<span class="token punctuation">.</span>github<span class="token punctuation">.</span>eirslett<span class="token operator">:</span>frontend<span class="token operator">-</span>maven<span class="token operator">-</span>plugin<span class="token operator">:</span><span class="token number">1.11</span><span class="token number">.3</span><span class="token operator">:</span>yarn <span class="token punctuation">(</span>yarn install<span class="token punctuation">)</span> on project rocketmq<span class="token operator">-</span>dashboard<span class="token operator">:</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">run</span> task<span class="token operator">:</span> 'yarn install' <span class="token class-name"><span class="token namespace">failed<span class="token punctuation">.</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>exec<span class="token punctuation">.</span></span>ExecuteException</span><span class="token operator">:</span> <span class="token class-name">Process</span> exited <span class="token keyword">with</span> <span class="token namespace">an</span> error<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token class-name">Exit</span> value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token class-name">Help</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token class-name">To</span> see the full stack trace of the errors<span class="token punctuation">,</span> re<span class="token operator">-</span>run <span class="token class-name">Maven</span> <span class="token keyword">with</span> <span class="token namespace">the</span> <span class="token operator">-</span>e <span class="token keyword">switch</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token class-name">Re</span><span class="token operator">-</span>run <span class="token class-name">Maven</span> using the <span class="token operator">-</span><span class="token class-name">X</span> <span class="token keyword">switch</span> <span class="token keyword">to</span> <span class="token namespace">enable</span> full debug logging<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token class-name">For</span> more information about the errors and possible solutions<span class="token punctuation">,</span> please read the following articles<span class="token operator">:</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Help</span> <span class="token number">1</span><span class="token punctuation">]</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cwiki<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>org<span class="token operator">/</span>confluence<span class="token operator">/</span>display<span class="token operator">/</span><span class="token constant">MAVEN</span><span class="token operator">/</span><span class="token class-name">MojoFailureException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解决方法：</p><p>打开项目中的pom.xml文件，注释以下两个插件</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--    &lt;plugin&gt;                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;                &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;                &lt;version&gt;2.17&lt;/version&gt;                &lt;executions&gt;                    &lt;execution&gt;                        &lt;id&gt;validate&lt;/id&gt;                        &lt;phase&gt;validate&lt;/phase&gt;                        &lt;configuration&gt;                            &lt;excludes&gt;src/main/resources&lt;/excludes&gt;                            &lt;configLocation&gt;style/rmq_checkstyle.xml&lt;/configLocation&gt;                            &lt;encoding&gt;UTF-8&lt;/encoding&gt;                            &lt;consoleOutput&gt;true&lt;/consoleOutput&gt;                            &lt;failsOnError&gt;true&lt;/failsOnError&gt;                        &lt;/configuration&gt;                        &lt;goals&gt;                            &lt;goal&gt;check&lt;/goal&gt;                        &lt;/goals&gt;                    &lt;/execution&gt;                &lt;/executions&gt;            &lt;/plugin&gt;   --&gt;</span><span class="token comment">&lt;!--    &lt;plugin&gt;                &lt;groupId&gt;com.github.eirslett&lt;/groupId&gt;                &lt;artifactId&gt;frontend-maven-plugin&lt;/artifactId&gt;                &lt;version&gt;1.11.3&lt;/version&gt;                &lt;configuration&gt;                    &lt;workingDirectory&gt;frontend&lt;/workingDirectory&gt;                    &lt;installDirectory&gt;target&lt;/installDirectory&gt;                &lt;/configuration&gt;                &lt;executions&gt;                    &lt;execution&gt;                        &lt;id&gt;install node and yarn&lt;/id&gt;                        &lt;goals&gt;                            &lt;goal&gt;install-node-and-yarn&lt;/goal&gt;                        &lt;/goals&gt;                        &lt;configuration&gt;                            &lt;nodeVersion&gt;v16.2.0&lt;/nodeVersion&gt;                            &lt;yarnVersion&gt;v1.22.10&lt;/yarnVersion&gt;                        &lt;/configuration&gt;                    &lt;/execution&gt;                    &lt;execution&gt;                        &lt;id&gt;yarn install&lt;/id&gt;                        &lt;goals&gt;                            &lt;goal&gt;yarn&lt;/goal&gt;                        &lt;/goals&gt;                        &lt;configuration&gt;                            &lt;arguments&gt;install&lt;/arguments&gt;                        &lt;/configuration&gt;                    &lt;/execution&gt;                    &lt;execution&gt;                        &lt;id&gt;yarn build&lt;/id&gt;                        &lt;goals&gt;                            &lt;goal&gt;yarn&lt;/goal&gt;                        &lt;/goals&gt;                        &lt;configuration&gt;                            &lt;arguments&gt;build&lt;/arguments&gt;                        &lt;/configuration&gt;                    &lt;/execution&gt;                &lt;/executions&gt;            &lt;/plugin&gt;   --&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有另一异常：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> <span class="token class-name">Failed</span> <span class="token keyword">to</span> <span class="token namespace">execute</span> goal org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">:</span>maven<span class="token operator">-</span>antrun<span class="token operator">-</span>plugin<span class="token operator">:</span><span class="token number">1.8</span><span class="token operator">:</span>run <span class="token punctuation">(</span><span class="token keyword">default</span><span class="token punctuation">)</span> on project rocketmq<span class="token operator">-</span>dashboard<span class="token operator">:</span> <span class="token class-name">An</span> <span class="token class-name">Ant</span> <span class="token class-name">BuildException</span> has occured<span class="token operator">:</span> <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">ProgramFiles</span>\<span class="token class-name">RocketMQ</span>\rocketmq<span class="token operator">-</span>dashboard\frontend\build does not exist<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token constant">ERROR</span><span class="token punctuation">]</span> around <span class="token class-name">Ant</span> part <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&lt;copy todir<span class="token operator">=</span><span class="token string">"D:\ProgramFiles\RocketMQ\rocketmq-dashboard\target/classes/public"</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> @ <span class="token number">4</span><span class="token operator">:</span><span class="token number">83</span> in <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">ProgramFiles</span>\<span class="token class-name">RocketMQ</span>\rocketmq<span class="token operator">-</span>dashboard\target\antrun\build<span class="token operator">-</span>main<span class="token punctuation">.</span>xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>解决：在 rocketmq-dashboard\frontend 建一个build文件夹，然后再target目录下，建一个classes文件夹,classes下再建一个public文件夹</p></li><li><p>执行mvn命令</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">mvn install <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>执行成功后，target目录下会有一个jar包，然后执行java命令运行就可以了。</p></li><li><p>访问：127.0.0.1:9998  (jar运行的服务器地址 : xml中配置的端口号）</p><img src="/2024/06/06/RocketMQ%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%89%E8%A3%85/bf119b4fad7460459535238ed6ddc43d.png" class="" title="可视化界面"><p>相关文章链接：<br> <a href="https://blog.csdn.net/qq_45515766/article/details/126360526">https://blog.csdn.net/qq_45515766/article/details/126360526</a><br> <a href="https://blog.csdn.net/xiaoyiny/article/details/132134052">https://blog.csdn.net/xiaoyiny/article/details/132134052</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rocketmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mvn命令报没有配置jdk环境</title>
      <link href="/2024/06/06/mvn%E5%91%BD%E4%BB%A4%E6%8A%A5%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AEjdk%E7%8E%AF%E5%A2%83/"/>
      <url>/2024/06/06/mvn%E5%91%BD%E4%BB%A4%E6%8A%A5%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AEjdk%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h1 id="mvn-命令报没有配置jdk环境"><a href="#mvn-命令报没有配置jdk环境" class="headerlink" title="mvn 命令报没有配置jdk环境"></a>mvn 命令报没有配置jdk环境</h1><p>jdk环境变量配置没问题，并且java -version 也正常显示。</p><p>执行mvn -v 报错误：</p><pre class="line-numbers language-none"><code class="language-none">/d/Program Files/maven/apache-maven-3.9.5/bin/mvn: line 93: cd: C:\Program Files\Java\jdk-19;: No such file or directoryThe JAVA_HOME environment variable is not defined correctly,this environment variable is needed to run this program.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>解决方法：</strong></p><ol><li>命令行设置<em>JAVA_HOME</em></li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//自己本机jdk安装目录（C:\Program Files\Java\jdk-19）</span>setx <span class="token constant">JAVA_HOME</span> <span class="token string">"C:\Program Files\Java\jdk-19"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="2"><li>更新<em>Path</em>变量</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//maven的安装目录（D:\Program Files\maven\apache-maven-3.9.5）</span>setx <span class="token constant">PATH</span> <span class="token string">"%JAVA_HOME%\bin;D:\Program Files\maven\apache-maven-3.9.5\bin;%PATH%"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li><em>关闭并重新打开命令提示符</em>，然后运行以下命令验证配置：</li></ol><pre class="line-numbers language-java" data-language="java"><code class="language-java">java <span class="token operator">-</span>versionmvn <span class="token operator">-</span>version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Bean 生命周期</title>
      <link href="/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Bean-生命周期"><a href="#Spring-Bean-生命周期" class="headerlink" title="Spring Bean 生命周期"></a>Spring Bean 生命周期</h2><h3 id="bean的4个阶段"><a href="#bean的4个阶段" class="headerlink" title="bean的4个阶段"></a>bean的4个阶段</h3><ol><li>Bean的<strong>实例化</strong>阶段</li><li>Bean的<strong>设置属性</strong>阶段</li><li>Bean的<strong>初始化</strong>阶段</li><li>Bean的<strong>销毁</strong>阶段</li></ol><img src="/2024/05/25/Spring-Bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/shengmingzhouqi.jpeg" class="" title="生命周期-流程图"><h4 id="实例化Bean"><a href="#实例化Bean" class="headerlink" title="实例化Bean"></a>实例化Bean</h4><ol><li><p>Bean Definition Loading（bean定义加载）</p><p>Spring容器从配置文件或者注解中读取Bean定义信息，这些定义信息包括Bean的类名、作用范围（scope）、依赖关系（循环依赖问题）、初始化方法。</p></li><li><p>Bean Instantiation（Bean实例化）</p><p>Spring<strong>通过反射机制创建Bean实例</strong>，spring调用Bean的构造函数来实例化对象。</p></li></ol><h4 id="设置属性"><a href="#设置属性" class="headerlink" title="设置属性"></a>设置属性</h4><ol><li><p>Spring容器在实例化Bean之后，会进行依赖注入，将Bean所依赖的其他Bean注入到该Bean中，此过程使用setter方法或者反射直接访问字段;</p><ul><li><p>bean依赖注入3种方式</p></li><li><p>@Autowired, @Resource, @Qualifier, @Bean 几个自动注入注解区别</p></li></ul></li></ol><h4 id="实现Aware类接口"><a href="#实现Aware类接口" class="headerlink" title="实现Aware类接口"></a>实现Aware类接口</h4><p>在<code>postProcessBeforeInitialization</code>方法执行前，会执行很多Aware类型的接口，这种接口的作用是：<strong>允许bean获取到Spring容器的特定资源或信息</strong>。由Spring容器自动调用相应的方法，<strong>将相关资源或信息注入到bean中</strong>。</p><p>常见Aware接口：</p><ol><li><code>BeanNameAware</code>：<ul><li>方法：<code>setBeanName(String name)</code></li><li>作用：将当前bean的名称注入到bean中。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>BeanFactoryAware</code>：<ul><li>方法：<code>setBeanFactory(BeanFactory beanFactory)</code></li><li>作用：将<code>BeanFactory</code>注入到bean中。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>ApplicationContextAware</code>：<ul><li>方法：<code>setApplicationContext(ApplicationContext applicationContext)</code></li><li>作用：将<code>ApplicationContext</code>注入到bean中。</li><li>执行时机：在<code>BeanFactoryAware</code>之后调用。</li></ul></li><li><code>ResourceLoaderAware</code>：<ul><li>方法：<code>setResourceLoader(ResourceLoader resourceLoader)</code></li><li>作用：将<code>ResourceLoader</code>注入到bean中，允许bean加载资源文件。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li><li><code>EnvironmentAware</code>：<ul><li>方法：<code>setEnvironment(Environment environment)</code></li><li>作用：将<code>Environment</code>注入到bean中，允许bean访问环境信息。</li><li>执行时机：bean实例化之后，但在依赖注入之前。</li></ul></li></ol><h4 id="BeanPostProcessor-初始化前后置处理"><a href="#BeanPostProcessor-初始化前后置处理" class="headerlink" title="BeanPostProcessor(初始化前后置处理)"></a>BeanPostProcessor(初始化前后置处理)</h4><ol><li><p>解释：</p><p>对新创建的bean实例进行自定义修改，通过实现该接口，可以<strong>在初始化bean前后进行额外的处理</strong>。</p></li><li><p>实现方法</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span><span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><code>postProcessBeforeInitialization</code>: 在bean初始化之前调用，可以对bean进行处理，然后放回处理后的bean实例。</li><li><code>postProcessAfterInitialization</code>: 在bean初始化之后调用，可以对bean进行后续处理，然后返回处理后的bean实例。</li></ul></li><li><p>使用场景</p><ul><li>日志记录：可以在bean初始化前后记录日志，方便调试和监控；</li><li>属性检查或设置：在bean初始化之前检查或设置某些属性；</li><li>代理对象创建：额可以在bean初始化之后创建代理对象，用于AOP场景；</li></ul></li></ol><h4 id="Bean初始化"><a href="#Bean初始化" class="headerlink" title="Bean初始化"></a>Bean初始化</h4><ul><li><p>使用@PostConstruct注解， 执行顺序 &gt; 下面两种方式</p></li><li><p>继承<code>InitializingBean</code>实现afterPropertiesSet()方法</p></li><li><p>在@Bean注解上指定初始化方法（等同于使用spring中xml方法指定init-method属性的方法，但是现在谁还用spring xml啊）</p></li></ul><h4 id="Bean销毁"><a href="#Bean销毁" class="headerlink" title="Bean销毁"></a>Bean销毁</h4><ul><li><code>@PreDestory</code> 注解，用于在Spring Bean被销毁之前执行清理逻辑（释放资源，关闭连接等），可以与 <code>@PostConstruct</code> 注解结合使用，确保在 Bean 初始化和销毁时执行相应的逻辑。</li><li>实现<code>DisposableBean</code>接口destroy()方法</li><li>在@Bean注解上destroyMethod属性指定销毁方法</li></ul><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token keyword">implements</span> <span class="token class-name">BeanNameAware</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> beanName<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"1.调用构造方法实例化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>beanName <span class="token operator">=</span> name<span class="token punctuation">;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"2.实现BeanNameAware接口：{}"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"3.实现ApplicationContextAware接口：{}"</span><span class="token punctuation">,</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"6.使用继承InitializingBean初始化：{}"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"7.使用init-method初始化：{}"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@PostConstruct</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"5.使用@PostConstruct初始化：{}"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@PreDestroy</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroyAnno</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"9.@PreDestroy销毁bean：{}"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"10.使用destroy-method配置销毁bean：{}"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanPostProcessorImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"4.实例：{} 初始化前"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"8.实例：{} 初始化后"</span><span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">BeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod <span class="token operator">=</span> <span class="token string">"init"</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">"destroy"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">MyBean</span> <span class="token function">myBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DestroyService</span> <span class="token keyword">implements</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"11.实现DisposableBean接口执行销毁方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.548</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">1.</span>调用构造方法实例化<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.550</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">2.</span>实现<span class="token class-name">BeanNameAware</span>接口：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.550</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">3.</span>实现<span class="token class-name">ApplicationContextAware</span>接口：<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>AnnotationConfigServletWebServerApplicationContext</span><span class="token annotation punctuation">@7e276594</span><span class="token punctuation">,</span> started on <span class="token class-name">Fri</span> <span class="token class-name">May</span> <span class="token number">24</span> <span class="token number">18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">57</span> <span class="token constant">CST</span> <span class="token number">2024</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.550</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>l<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>BeanPostProcessorImpl</span>     <span class="token operator">:</span> <span class="token number">4.</span>实例：myBean 初始化前<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.551</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">5.</span>使用<span class="token annotation punctuation">@PostConstruct</span>初始化：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.551</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">6.</span>使用继承<span class="token class-name">InitializingBean</span>初始化：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.552</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">7.</span>使用init<span class="token operator">-</span>method初始化：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">58.552</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>l<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>BeanPostProcessorImpl</span>     <span class="token operator">:</span> <span class="token number">8.</span>实例：myBean 初始化后<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">15.637</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>ionShutdownHook<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">9.</span>@<span class="token class-name">PreDestroy</span>销毁bean：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">15.638</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>ionShutdownHook<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>MyBean</span>             <span class="token operator">:</span> <span class="token number">10.</span>使用destroy<span class="token operator">-</span>method配置销毁bean：myBean<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">24</span><span class="token constant">T18</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">15.638</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">18372</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>springs<span class="token punctuation">]</span> <span class="token punctuation">[</span>ionShutdownHook<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>leejie<span class="token punctuation">.</span>springBean<span class="token punctuation">.</span></span>DestroyService</span>     <span class="token operator">:</span> <span class="token number">11.</span>实现<span class="token class-name">DisposableBean</span>接口执行销毁方法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>springboot之监听器</title>
      <link href="/2022/06/17/springboot%E4%B9%8B%E7%9B%91%E5%90%AC%E5%99%A8/"/>
      <url>/2022/06/17/springboot%E4%B9%8B%E7%9B%91%E5%90%AC%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="springboot之监听器"><a href="#springboot之监听器" class="headerlink" title="springboot之监听器"></a>springboot之监听器</h1><p>ApplicationContext提供时间处理通过ApplicationEvent类和ApplicationListener接口，如果一个bean实现ApplicationListener接口在容器中，每次一个ApplicationEvent被发布到ApplcationContext中，这类bean就会收到这些通知。</p><p>实现Spring事件机制主要有4个类：</p><p>ApplicationEvent：事件，每个实现类表示一类事件，可携带数据。</p><p>ApplicationListener：事件监听器，用于接收事件处理时间。</p><p>ApplicationEventMulticaster：事件管理者，用于事件监听器的注册和事件的广播。</p><p>ApplicationEventPublisher：事件发布者，委托ApplicationEventMulticaster完成事件发布。</p><h2 id="监听器使用"><a href="#监听器使用" class="headerlink" title="监听器使用"></a>监听器使用</h2><p>Web监听器的使用场景很多，比如监听servlet上下应用来初始化一些数据，监听HTTP Session 用来获取当前在线人数，监听客服端请求的ServletRequest 对象来获取用户的访问信息等等。</p><h3 id="监听-Servlet-上下文对象"><a href="#监听-Servlet-上下文对象" class="headerlink" title="监听 Servlet 上下文对象"></a>监听 Servlet 上下文对象</h3><ol><li><p>首先我们要知道ServletContext的作用和详解</p><p>ServletContext是一个全局的存储信息的空间，服务器开始就存在，服务器关闭就释放。request，一个用户可以有多个；session，一个用户一个；而servletContext是所有用户共用一个。</p><p>运行在java虚拟机中的每一个web程序都有一个与之相关的Servlet上下文。一个ServletContext对象表示了一个web应用程序的上下文。</p><p>Servlet上下文：Servlet上下文提供了对应用程序中所有Servlet所共有的各种资源和功能的访问。Servlet上下文API用于设置应用程序中所有Servlet共有的信息。Servlet可能需要共享他们之间的共有信息。运行于同一服务器的Servlet有时会共享资源，如JSP页面、文件和其他Servlet。</p></li></ol><p>实践：<a href="https://blog.csdn.net/taojin12/article/details/88338199">Spring Boot 中使用监听器</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分布式事务</title>
      <link href="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
      <url>/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h1><h3 id="什么是分布式？"><a href="#什么是分布式？" class="headerlink" title="什么是分布式？"></a>什么是分布式？</h3><p>了解分布式之前先看一下单机和集群的概念</p><p><strong>单机结构</strong></p><p>单机就是所有业务全部写在一个项目中，部署服务到一台服务器上，所有请求业务都由这台服务器去处理，当业务增长到一定程度的时候，服务器的硬件会无法满足业务需求，然后就会想到一个程序不行就部署多个。</p><p><strong>集群</strong></p><ol><li>集群就是单机的多实例，在多个服务器上部署多个服务，每个服务就是一个节点，部署N个节点，处理业务的能力就提升N倍，这些节点的结合就叫做集群。</li><li>负载均衡：协调群里的每个节点均衡的接受业务请求，通俗的讲就是服务A和服务B相同时间段内处理的同类业务请求数量是类似的。</li></ol><p><strong>分布式</strong></p><p>分布式服务顾名思义服务是分散部署在不同的机器上的，一个服务可能负责几个功能，是一种面向SOA架构的，服务之间也是通过rpc来交互或者是webservice来交互的。逻辑架构设计完后就该做物理架构设计，系统应用部署在超过一台服务器或虚拟机上，且各分开部署的部分彼此通过各种通讯协议交互信息，就可算作分布式部署，生产环境下的微服务肯定是分布式部署的，分布式部署的应用不一定是微服务架构的，比如集群部署，它是把相同应用复制到不同服务器上，但是逻辑功能上还是单体应用。<br>举个例子，假如需要开发一个在线商城。按照微服务的思想，我们需要按照功能模块拆分成多个独立的服务，如：用户服务、产品服务、订单服务、后台管理服务、数据分析服务等。</p><h3 id="分布式事务-1"><a href="#分布式事务-1" class="headerlink" title="分布式事务"></a>分布式事务</h3><p>分布式事务用于在分布式系统中保证不同节点之间的数据一致性。分布式事务的实现有很多中，最具有代表性的是oracle系统提出的XA分布式事务协议。</p><p>XA协议包含两阶段提交（2PC）和三阶段提交（3PC）两种实现：</p><p>在XA协议中包含着两个角色：事务协调者和事务参与者。</p><p><strong>第一阶段</strong></p><img src="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/001dcf51c7a64b9249e0fe6fc1b546ce.png" class="" title="第一阶段"><p>在XA分布式事务的第一阶段，作为事务协调者的阶段会首先向所有的参与者节点发送Prepare请求。</p><p>在接到Prepare请求之后，每个参与者节点会各自事务相关的数据更新，写入Undo Log 和 Redo Log。如果参与者执行成功，暂时不提交事务，而是向事务协调节点返回“完成”消息。</p><p>当事务协调者接收到所有参与者返回消息，整个分布式事务将会进入第二阶段。</p><p><strong>第二阶段</strong></p><img src="/2022/06/14/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/98e89361be7f3457d3d1a1aea975d523.png" class="" title="第二阶段"><p>在XA分布式事务的第二阶段，如果事务协调节点在之前所收到都是正向返回，那么他将会向所有事务参与者发出commit提交。</p><p>接到commit请求之后，十五参与者节点会各自进行本地的事务提交，并释放资源。当本地事务完成提交之后，将会向事务协调者返回“完成”消息。</p><p>当事务协调者接收到所有事务参与者的“完成”反馈，整个分布式事务完成。</p><p><strong>失败处理流程</strong></p><p>在XA的第一阶段，如果某个事务参与者反馈失败消息，说明该节点的本地事务执行不成功，必须回滚。</p><p>于是在第二阶段，事务协调节点向所有的事务参与者发送Abort请求。接收到Abort请求之后，各个事务参与者节点需要在本地进行事务的回滚操作，回滚操作依照Undo Log来进行。</p><p><strong>两段提交不足之处</strong></p><ol><li><p>性能问题</p><p>XA协议遵循强一致性。在事务执行过程中，各个节点占用着数据库资源，只有当所有阶段准备完毕，事务协调者才会通知提交，参与者提交之后释放资源。这样的过程有着非常明显的性能问题。</p></li><li><p>协调者单点故障问题</p><p>事务协调这是整个XA模型的核心，一旦事务协调者节点挂掉，参与者收不到提交或是回国通知，参与者会一直处于中间状态无法完成事务。</p></li><li><p>丢失消息导致不一致问题</p><p>在第二阶段，如果发生局部网络问题，一部分事务参与者收到提交消息，另一部分事务参与者没收到提交消息，那么就导致了节点之间数据的不一致。</p></li></ol><p><strong>解决方案：</strong></p><ol><li><p>XA三段提交</p><p>XA三阶段提交在两阶段提交的基础上增加了CanCommit阶段，并且引入了超时机制。一旦事物参与者迟迟没有接到协调者的commit请求，会自动进行本地commit。这样有效解决了协调者单点故障的问题。但是性能问题和不一致的问题仍然没有根本解决。</p></li><li><p>MQ事务</p><p>利用消息中间件来异步完成事务的后一半更新，实现系统的最终一致性。这个方式避免了像XA协议那样的性能问题。</p></li><li><p>TCC事务</p><p>TCC事务是Try、Commit、Cancel三种指令的缩写，其逻辑模式类似于XA两阶段提交，但是实现方式是在代码层面来人为实现。</p></li></ol><p>推荐文章：<a href="https://blog.csdn.net/bjweimengshu/article/details/79607522">漫画：什么是分布式事务？</a>   <a href="https://zhuanlan.zhihu.com/p/183753774">分布式事务六种解决方案</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 分布式事务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2022/06/12/Redis/"/>
      <url>/2022/06/12/Redis/</url>
      
        <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p><strong>redis有哪些数据类型？</strong></p><p>String，List，Set，Zset，Hash</p><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><p><strong>什么是redis持久化？</strong></p><p>持久化就是把内存的数据写到磁盘中，防止服务宕机了，导致内存数据丢失。</p><p><strong>Redis的持久化机制是什么？</strong></p><p>redis提供了两种持久化机制 RDB 和 AOF机制。</p><ul><li><p><strong>RDB：</strong></p><p>redis默认的持久化方式，按照一定的时间将内存的数据以<em><strong>快照</strong></em>的形式保存到硬盘中，对应产出的数据文件为dump.rdb。通过配置文件中的save参数来定义快照的周期。</p><p>优点：</p><p>只有一个文件dump.rdb，方便持久化。</p><p>容灾性好，一个文件可以保存到安全的磁盘。</p><p>性能最大化，fork子进程来完成写操作，让主进程继续处理命令，所以是IO最大化，使用单独进程来进行持久化，主进程不会进行任何IO操作，保证了redis的高性能。</p><p>相对于数据集大时，比AOF的启动效率更高。</p><p>缺点：</p><p>数据安全性低，RDB是间隔一段时间进行持久化，如果持久化之间redis发生故障，会发生数据丢失。</p><p>AOF持久化方式：是指所有命令行记录以redis命令请求协议的格式完成持久化存储，保存为AOF文件。</p></li><li><p><strong>AOF</strong></p><p>AOF持久化，则是将redis的执行每次写命令记录到单独的日志文件中，当重启redis会重新将持久化的日志中文件恢复数据。</p><p>当两种方式同时开启时，数据恢复redis会优先选择AOF恢复。</p><p>优点：</p><p>数据安全，aof持久化可以配置appendfsync 属性，有always。每进行一次命令操作就记录到aof文件中一次。</p><p>通过append模式写文件，即使中途服务器宕机，可以通过redis-check-aof 工具解决数据一致性问题。</p><p>AOF机制的rewrite模式，AOF文件没被rewrite之前，可以删除其中的某些命令。</p><p>缺点：</p><p>AOF文件比RDB文件大，且恢复速度慢。</p><p>数据集大的时候，比rdb启动效率低。</p></li></ul><p><strong>两个持久性方式的区别：</strong></p><ul><li>AOF文件比RDB更新频率高，优先使用AOF还原数据。</li><li>AOF比RDB更安全也更大</li><li>RDB性能比AOF好</li><li>如果两个都配了优先加载AOF</li></ul><h3 id="内存相关"><a href="#内存相关" class="headerlink" title="内存相关"></a>内存相关</h3><p><strong>redis中数据如何保证都是热点数据？</strong></p><p>redis内存数据集大熊啊上升到一定大小的时候，就会实行数据淘汰策略。</p><p><strong>redis内存淘汰策略</strong></p><p>全局的见空间选择性移除</p><ul><li>noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。</li><li>allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key。</li><li>allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个key。</li></ul><p>设置过期时间的键空间选择性移除：</p><ul><li>volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的key。</li><li>volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个key。</li><li>volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的key优先移除。</li></ul><h3 id="redis事务"><a href="#redis事务" class="headerlink" title="redis事务"></a>redis事务</h3><h3 id="redis集群"><a href="#redis集群" class="headerlink" title="redis集群"></a>redis集群</h3><h4 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h4><p>哨兵模式主要是用于实现redis集群的高可用。</p><ol><li>集群监控：负责监控redis master 和 slave 进程是否正常工作。</li><li>消息通知：如果redis实例有故障，那么哨兵负责发送消息作为报警通知给管理员，</li><li>故障转移：如果master node 挂掉，会自动转移到 slave node上。</li><li>配置中心：如果故障转移发生了，通知client客服端新的 master地址。</li></ol><p>核心：</p><ol><li>哨兵至少需要3个实例，保证自己的健壮性。</li><li>哨兵+redis 主从的部署架构，是不保证数据零丢失的，只能保证redis集群的高可用性。</li></ol><h4 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="Redis Cluster"></a>Redis Cluster</h4><p>redis cluster 是一种服务端Sharding技术，3.0版本开始正式提供。redis cluster并没有使用一致性hash，而是采用slot的概念，一种分成16384个槽。将请求发送到任意节点，接收到请求的节点会将查询请求发送到正确的节点上执行。</p><p>方案说明：</p><ol><li>通过哈希的方式，将数据分片，每个节点均分存储一定哈希槽(哈希值)区间的数据，默认分赔了16384个槽位。</li><li>每份数据分片会存储在多个互为主从的多节点上。</li><li>数据写入先写主节点，在同步到从节点(支持配置为阻塞同步)</li><li>同一分片多个节点间的数据不保持一致性。</li><li>读取数据时，当客服端操作的key没有分配在该节点上时，redis会返回转向指令，指向正确的节点</li><li>扩容时需要把就节点数据迁移的一部分到新节点。</li></ol><p><strong>分布式寻址算法</strong></p><ul><li>hash算法</li><li>一致性hash算法 （自动缓存迁移）+ 虚拟节点（自动负载均衡）</li><li>redis cluster 的 hash slot 算法</li></ul><h4 id="Redis主从架构"><a href="#Redis主从架构" class="headerlink" title="Redis主从架构"></a>Redis主从架构</h4><p>对于缓存来说，一般都是用来支撑读高并发的，因此架构做成主从架构，一主多从，主负责写，并且将数据复制到其他的slave节点，从节点负责读。所有的读请求全部走从节点。轻松实现水平扩容，支撑读高并发。</p><p>redis replication -&gt; 主从架构 -&gt; 读写分离 -&gt; 水平扩容支撑读高并发、</p><p><strong>redis主从复制的核心原理</strong></p><p>当启动一个从节点的时候，他会发送一个<code>PSYNC</code> 命令给 主节点。</p><p>如果这是 从节点 初次连接到主节点，那么会触发一次 <code>full resynchronization</code> 全量复制。此时 master 会启动一个后台线程，开始生成一份 <code>RDB</code> 快照文件。</p><p>同时还会将从客户端 client 新收到的所有写命令缓存在内存中。<code>RDB</code> 文件生成完毕后， master 会将这个 <code>RDB</code> 发送给 slave，slave 会先<strong>写入本地磁盘，然后再从本地磁盘加载到内存</strong>中，</p><p>接着master会将内存中缓存的写命令发送到slave，slave也会同步这些数据。</p><p>过程原理</p><ol><li>当从库和主库建立MS关系后，会向主数据库发送SYNC命令</li><li>主库接收到SYNC命令后会开始在后台保存快照(RDB持久化过程)，并将期间接收到的写命令缓存起来</li><li>当快照完成后，主Redis会将快照文件和所有缓存的写命令发送给从Redis</li><li>从Redis接收到后，会载入快照文件并且执行收到的缓存的命令</li><li>之后，主Redis每当接收到写命令时就会将命令发送从Redis，从而保证数据的一致</li></ol><h4 id="redis集群会有写操作丢失吗？"><a href="#redis集群会有写操作丢失吗？" class="headerlink" title="redis集群会有写操作丢失吗？"></a><strong>redis集群会有写操作丢失吗？</strong></h4><p>因为redis不能保证数据的强一致性，所以会存在丢失写操作。</p><h4 id="Redis是单线程的，如何提高多核CPU的利用率？"><a href="#Redis是单线程的，如何提高多核CPU的利用率？" class="headerlink" title="Redis是单线程的，如何提高多核CPU的利用率？"></a>Redis是单线程的，如何提高多核CPU的利用率？</h4><p>可以在同一个服务器部署多个Redis的实例，并把他们当作不同的服务器来使用，在某些时候，无论如何一个服务器是不够的， 所以，如果你想使用多个CPU，你可以考虑一下分片（shard）。</p><h4 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h4><p>redis为单进程单线程模式，采用队列模式将并发访问编程串行访问，且多客服端对redis的连接并不存在竞争关系，Redis中可以使用SETNX命令实现分布式锁。</p><p>使用SETNX完成同步锁的流程：</p><p>使用SETNX命令获取锁，若返回0（key已存在，锁已存在）则获取失败，反之获取成功</p><p>为了防止获取锁后程序出现异常，导致其他线程/进程调用SETNX命令总是返回0而进入死锁状态，需要为该key设置一个“合理”的过期时间</p><p>释放锁，使用DEL命令将锁数据删除</p><h4 id="什么是-RedLock"><a href="#什么是-RedLock" class="headerlink" title="什么是 RedLock"></a>什么是 RedLock</h4><p>Redis 官方站提出了一种权威的基于 Redis 实现分布式锁的方式名叫 Redlock，此种方式比原先的单节点的方法更安全。它可以保证以下特性：</p><ol><li>安全特性：互斥访问，即永远只有一个 client 能拿到锁</li><li>避免死锁：最终 client 都可能拿到锁，不会出现死锁的情况，即使原本锁住某资源的 client crash 了或者出现了网络分区</li><li>容错性：只要大部分 Redis 节点存活就可以正常提供服务</li></ol><h3 id="缓存异常"><a href="#缓存异常" class="headerlink" title="缓存异常"></a>缓存异常</h3><h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><p>缓存雪崩是指缓存同一时间大面积的失效，后面的请求都会落到数据库上，造成数据库短时间内承受大量请求而崩掉。</p><p>解决方案：</p><ol><li>缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生。</li><li>一般并发量不是特别多的时候，使用最多的解决方案时加锁排队。</li><li>给每个缓存数据增加相应的缓存标记，记录缓存是否失效，如果缓存标记失效，则更新数据缓存。</li></ol><h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><p>缓存穿透是指缓存和数据库中都没有的数据，导致所有的请求都落到数据库上，造成数据库短时间内承受大量请求而崩掉。</p><p>解决方案：</p><ol><li>接口层增加校验，如用户鉴权校验，id做基础校验，id&lt;=0的直接拦截。</li><li>从缓存取不到，在数据库中也没有取到的数据，可以将key-value对写为key-null，缓存有效时间可以设置短一点。这样可以防止攻击用户反复用同一个id暴力攻击。</li><li>采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。</li></ol><p><strong>布隆过滤器</strong></p><p>引入了k(k&gt;1)个相互独立的哈希函数，保证在给定的空间、误判率下，完成元素判重的过程。</p><p>他的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难。</p><p>Bloom-Filter算法的核心思想就是利用多个不同的Hash函数来解决“冲突”。<br>Hash存在一个冲突（碰撞）的问题，用同一个Hash得到的两个URL的值有可能相同。为了减少冲突，我们可以多引入几个Hash，如果通过其中的一个Hash值我们得出某元素不在集合中，那么该元素肯定不在集合中。只有在所有的Hash函数告诉我们该元素在集合中时，才能确定该元素存在于集合中。这便是Bloom-Filter的基本思想。<br>Bloom-Filter一般用于在大数据量的集合中判定某元素是否存在。</p><h4 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h4><p>缓存击穿是指缓存中没有但数据库中存在的数据。这时由于并发用户特别多，同时都缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力。</p><p>解决方案：</p><ol><li>设置热点数据永不过期</li><li>加互斥锁</li></ol><h4 id="缓存预热"><a href="#缓存预热" class="headerlink" title="缓存预热"></a>缓存预热</h4><p>缓存预热就是系统上线后，将相关的缓存数据直接加载到缓存系统。这样就可以避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题。</p><h4 id="缓存热点key"><a href="#缓存热点key" class="headerlink" title="缓存热点key"></a>缓存热点key</h4><p>缓存中的一个Key(比如一个促销商品)，在某个时间点过期的时候，恰好在这个时间点对这个Key有大量的并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
